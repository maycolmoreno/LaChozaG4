<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="contenido">
    <h2 class="mb-4"> Gesti贸n de Mesas</h2>

    <form id="formMesa" class="mb-4 card p-4 shadow-sm">
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">N煤mero de Mesa</label>
                <input type="number" class="form-control" id="numero" placeholder="Ej: 5" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Capacidad (Personas)</label>
                <input type="number" class="form-control" id="capacidad" placeholder="Ej: 4" required>
            </div>
            <div class="col-md-4">
                <label class="form-label">Ubicaci贸n</label>
                <select class="form-select" id="ubicacion">
                    <option value="Sal贸n Principal">Sal贸n Principal</option>
                    <option value="Terraza">Terraza</option>
                    <option value="VIP">Zona VIP</option>
                </select>
            </div>
        </div>
        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Guardar Mesa</button>
        </div>
    </form>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>N煤mero</th>
                    <th>Capacidad</th>
                    <th>Ubicaci贸n</th>
                    <th>Estado</th>
                </tr>
                </thead>
                <tbody id="tablaMesas">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = '/api/mesas';

        // Funci贸n para listar mesas (GET)
        async function cargarMesas() {
            try {
                const res = await fetch(API_URL);
                const mesas = await res.json();
                document.getElementById('tablaMesas').innerHTML = mesas.map(m => `
                    <tr>
                        <td>${m.id}</td>
                        <td>Mesa ${m.numero}</td>
                        <td>${m.capacidad} pers.</td>
                        <td>${m.ubicacion}</td>
                        <td>
                            <span class="badge ${m.estado === 'LIBRE' ? 'bg-success' : 'bg-warning'}">
                                ${m.estado || 'LIBRE'}
                            </span>
                        </td>
                    </tr>
                `).join('');
            } catch (e) { console.error("Error al cargar:", e); }
        }

        // Funci贸n para guardar mesa (POST)
        document.getElementById('formMesa').addEventListener('submit', async (e) => {
            e.preventDefault();
            const mesaData = {
                numero: document.getElementById('numero').value,
                capacidad: document.getElementById('capacidad').value,
                ubicacion: document.getElementById('ubicacion').value,
                estado: 'LIBRE'
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(mesaData)
            });

            if (response.ok) {
                document.getElementById('formMesa').reset();
                cargarMesas(); // Recargar tabla abajo
            }
        });

        // Cargar al inicio
        cargarMesas();
    </script>
</div>
</html>