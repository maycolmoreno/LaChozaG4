<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<!-- ====================================
     FRAGMENTO: pedido
     ==================================== -->
<div th:fragment="contenido">

	<!-- ====================================
	     HEADER CON BOTÃ“N NUEVO PEDIDO
	     ==================================== -->
	<header class="bg-primary text-white text-center py-4 mb-4">
		<div class="container d-flex justify-content-between align-items-center">
			<div>
				<h1 class="mb-0">ğŸ§¾ Sistema de Pedidos</h1>
				<p class="mb-0">CevicherÃ­a "La Choza"</p>
			</div>
			<button class="btn btn-success btn-lg" onclick="abrirModalNuevoPedido()">
				â• Nuevo Pedido
			</button>
		</div>
	</header>

	<!-- ====================================
	     FILTROS
	     ==================================== -->
	<div class="container mb-4">
		<div class="row">
			<div class="col-md-4 mb-3">
				<label class="form-label fw-semibold">ğŸ” Filtrar por Estado:</label>
				<select id="filtroEstado" class="form-select">
					<option value="">Todos los pedidos</option>
					<option value="PENDIENTE">ğŸŸ¡ Pendientes</option>
					<option value="EN_PREPARACION">ğŸ”µ En PreparaciÃ³n</option>
					<option value="ENTREGADO">ğŸŸ¢ Entregados</option>
					<option value="PAGADO">âœ… Pagados</option>
					<option value="CANCELADO">ğŸ”´ Cancelados</option>
				</select>
			</div>
			
			<div class="col-md-4 mb-3">
				<label class="form-label fw-semibold">ğŸª‘ Filtrar por Mesa:</label>
				<select id="filtroMesa" class="form-select">
					<option value="">Todas las mesas</option>
					<option value="1">Mesa 1</option>
					<option value="2">Mesa 2</option>
					<option value="3">Mesa 3</option>
					<option value="4">Mesa 4</option>
					<option value="5">Mesa 5</option>
					<option value="6">Mesa 6</option>
					<option value="7">Mesa 7</option>
					<option value="8">Mesa 8</option>
					<option value="9">Mesa 9</option>
					<option value="10">Mesa 10</option>
				</select>
			</div>
			
			<div class="col-md-4 mb-3 d-flex align-items-end">
				<button onclick="cargarPedidos()" class="btn btn-primary w-100">
					ğŸ”„ Actualizar
				</button>
			</div>
		</div>
	</div>

	<!-- ====================================
	     ESTADÃSTICAS
	     ==================================== -->
	<div class="container mb-4">
		<div class="row" id="estadisticas">
			<div class="col-md-3 mb-3">
				<div class="card bg-warning text-dark">
					<div class="card-body text-center">
						<h3 class="mb-0" id="stat-pendientes">0</h3>
						<small>Pendientes</small>
					</div>
				</div>
			</div>
			<div class="col-md-3 mb-3">
				<div class="card bg-info text-white">
					<div class="card-body text-center">
						<h3 class="mb-0" id="stat-preparacion">0</h3>
						<small>En PreparaciÃ³n</small>
					</div>
				</div>
			</div>
			<div class="col-md-3 mb-3">
				<div class="card bg-success text-white">
					<div class="card-body text-center">
						<h3 class="mb-0" id="stat-entregados">0</h3>
						<small>Entregados</small>
					</div>
				</div>
			</div>
			<div class="col-md-3 mb-3">
				<div class="card bg-primary text-white">
					<div class="card-body text-center">
						<h3 class="mb-0" id="stat-total">$0.00</h3>
						<small>Total del dÃ­a</small>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ====================================
	     LISTADO DE PEDIDOS
	     ==================================== -->
	<main class="container">
		<div id="contenedor-pedidos" class="row">
			<!-- Loader inicial -->
			<div class="col-12 text-center py-5">
				<div class="spinner-border text-primary" role="status">
					<span class="visually-hidden">Cargando...</span>
				</div>
				<p class="mt-3">Cargando pedidos...</p>
			</div>
		</div>
	</main>

	<!-- ====================================
	     MODAL NUEVO PEDIDO
	     ==================================== -->
	<div id="modal-nuevo-pedido" class="modal fade" tabindex="-1">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header bg-success text-white">
					<h5 class="modal-title">â• Nuevo Pedido</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					
					<!-- SelecciÃ³n de Mesa -->
					<div class="row mb-4">
						<div class="col-md-6">
							<label class="form-label fw-bold">ğŸª‘ Seleccionar Mesa *</label>
							<select id="nuevoPedidoMesa" class="form-select form-select-lg" required>
								<option value="">-- Seleccione una mesa --</option>
							</select>
						</div>
						<div class="col-md-6">
							<label class="form-label fw-bold">ğŸ‘¤ Cliente (opcional)</label>
							<input type="text" id="nuevoPedidoCliente" class="form-control" 
							       placeholder="Nombre del cliente">
						</div>
					</div>

					<!-- BÃºsqueda de productos -->
					<div class="mb-3">
						<label class="form-label fw-bold">ğŸ” Buscar producto:</label>
						<input type="text" id="buscarProducto" class="form-control" 
						       placeholder="Escriba el nombre del producto...">
					</div>

					<!-- Lista de productos -->
					<div class="row mb-4" id="listaProductos" style="max-height: 300px; overflow-y: auto;">
						<!-- Se carga dinÃ¡micamente -->
					</div>

					<hr>

					<!-- Carrito de pedido -->
					<h6 class="mb-3">ğŸ›’ Items del pedido:</h6>
					<div id="carritoItems">
						<p class="text-muted text-center py-3">No hay items agregados</p>
					</div>

					<!-- Totales -->
					<div class="text-end">
						<p class="mb-1">Subtotal: <strong id="carritoSubtotal">$0.00</strong></p>
						<p class="mb-1">IVA (15%): <strong id="carritoIva">$0.00</strong></p>
						<h5 class="mb-0">TOTAL: <strong class="text-success" id="carritoTotal">$0.00</strong></h5>
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
					<button type="button" class="btn btn-success btn-lg" onclick="confirmarNuevoPedido()">
						âœ… Confirmar Pedido
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ====================================
	     MODAL DETALLE PEDIDO
	     ==================================== -->
	<div id="modal-detalle-pedido" class="modal fade" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title">ğŸ“‹ Detalle del Pedido</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" id="detalle-pedido-content">
					<!-- Se carga dinÃ¡micamente -->
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ====================================
	     FOOTER
	     ==================================== -->
	<footer class="container text-center py-4 mt-5">
		<p class="text-muted mb-0">
			Â© 2024 PISIP - CevicherÃ­a "La Choza"
		</p>
	</footer>

</div>
</html>